<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Query + Hash + Path 参数解析靶场</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&display=swap" rel="stylesheet">
  <style>
    :root {
      --background: #ffffff;
      --foreground: #000000;
      --muted-foreground: #525252;
    }
    * { box-sizing: border-box }
    body {
      margin: 0;
      padding: 40px 24px;
      background: var(--background);
      color: var(--foreground);
      font-family: "Source Serif 4", Georgia, serif;
      line-height: 1.6;
      min-height: 100vh;
    }
    .container { max-width: 960px; margin: 0 auto }
    h1 {
      font-family: "Playfair Display", Georgia, serif;
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: -0.025em;
      margin: 0 0 32px;
      line-height: 1.1;
      border-bottom: 4px solid var(--foreground);
      padding-bottom: 24px;
      text-transform: uppercase;
    }
    .section { border: 1px solid var(--foreground); padding: 24px; margin-bottom: 24px }
    .label {
      font-family: "JetBrains Mono", monospace;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      border-bottom: 1px solid var(--foreground);
      display: inline-block;
      margin-bottom: 16px;
      padding-bottom: 4px;
    }
    .row { display: grid; grid-template-columns: 1fr; gap: 16px }
    @media (min-width: 920px) { .row { grid-template-columns: 1fr 1fr } }
    label {
      display: block;
      font-family: "JetBrains Mono", monospace;
      font-size: 14px;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px 0;
      border: none;
      border-bottom: 2px solid var(--foreground);
      background: transparent;
      font-family: "Source Serif 4", Georgia, serif;
      font-size: 18px;
      color: var(--foreground);
      border-radius: 0;
      outline: none;
      transition: border-width 100ms;
    }
    input[type="text"]::placeholder { color: var(--muted-foreground); font-style: italic }
    input[type="text"]:focus { border-bottom-width: 4px }
    .btn {
      appearance: none;
      background: var(--foreground);
      color: var(--background);
      border: none;
      padding: 12px 24px;
      font-family: "JetBrains Mono", monospace;
      font-size: 14px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
    }
    .btn:hover { background: var(--background); color: var(--foreground); border: 2px solid var(--foreground) }
    .kv { display: grid; grid-template-columns: 180px 1fr; gap: 8px; align-items: baseline }
    .kv .k {
      font-family: "JetBrains Mono", monospace;
      font-size: 13px;
      letter-spacing: 0.05em;
    }
    .kv .v { font-size: 18px }
    .chips { display: flex; flex-wrap: wrap; gap: 8px }
    .chip {
      border: 2px solid var(--foreground);
      padding: 6px 10px;
      font-family: "JetBrains Mono", monospace;
      font-size: 13px;
      letter-spacing: 0.05em;
    }
    .chip.param { background: var(--foreground); color: var(--background) }
    .hr { height: 4px; background: var(--foreground); margin: 24px 0 }
    .panel-invert { background: var(--foreground); color: var(--background); padding: 16px; border: 4px solid var(--foreground) }
    .panel-invert .kv .k { color: var(--background) }
    .panel-invert .chip { border-color: var(--background); color: var(--background) }
    .panel-invert .chip.param { background: var(--background); color: var(--foreground) }
  </style>
</head>
<body>
  <div class="container">
    <h1>Query + Hash + Path 参数解析靶场</h1>

    <div class="section">
      <div class="label">输入 URL</div>
      <div class="row">
        <div>
          <label for="url">目标地址</label>
          <input id="url" type="text" placeholder="输入或粘贴一个复杂的 URL">
        </div>
        <div style="display:flex; align-items:flex-end">
          <button class="btn" id="parse">解析</button>
          <div style="width:12px"></div>
          <button class="btn" id="makeReal">真实化当前页面 URL</button>
        </div>
      </div>
    </div>

    <div class="hr"></div>

    <div class="section">
      <div class="label">路径参数区 (Path Params)</div>
      <div class="kv"><div class="k">Path</div><div class="v" id="pathValue"></div></div>
      <div style="height:8px"></div>
      <div class="chips" id="pathTokens"></div>
    </div>

    <div class="section">
      <div class="label">标准查询区 (Query Params)</div>
      <div id="queryList"></div>
    </div>

    <div class="section panel-invert">
      <div class="label">复杂 Hash 区 (Hash + Internal Query)</div>
      <div class="kv"><div class="k">Hash Path</div><div class="v" id="hashPathValue"></div></div>
      <div style="height:8px"></div>
      <div class="chips" id="hashPathTokens"></div>
      <div style="height:16px"></div>
      <div class="kv"><div class="k">Hash Query</div><div class="v"></div></div>
      <div id="hashQueryList"></div>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('url');
    const parseBtn = document.getElementById('parse');
    const makeRealBtn = document.getElementById('makeReal');
    const pathValue = document.getElementById('pathValue');
    const pathTokens = document.getElementById('pathTokens');
    const queryList = document.getElementById('queryList');
    const hashPathValue = document.getElementById('hashPathValue');
    const hashPathTokens = document.getElementById('hashPathTokens');
    const hashQueryList = document.getElementById('hashQueryList');

    function classifyToken(t) {
      const verbs = new Set(['api','storage','files','viewer']);
      if (verbs.has(t)) return 'verb';
      if (/^v\d+$/i.test(t)) return 'param';
      if (/\d/.test(t)) return 'param';
      return 'noun';
    }

    function renderChips(el, tokens) {
      el.innerHTML = '';
      tokens.forEach(t => {
        const span = document.createElement('span');
        const type = classifyToken(t);
        span.className = 'chip' + (type === 'param' ? ' param' : '');
        span.textContent = t + (type === 'param' ? ' • param' : type === 'verb' ? ' • verb' : ' • noun');
        el.appendChild(span);
      });
    }

    function renderKVList(el, params) {
      el.innerHTML = '';
      const frag = document.createDocumentFragment();
      for (const [k, v] of params) {
        const row = document.createElement('div');
        row.className = 'kv';
        const kk = document.createElement('div');
        kk.className = 'k';
        kk.textContent = k;
        const vv = document.createElement('div');
        vv.className = 'v';
        vv.textContent = v;
        row.append(kk, vv);
        frag.appendChild(row);
      }
      el.appendChild(frag);
    }

    function parseCurrent() {
      const raw = urlInput.value.trim();
      let u;
      try { u = new URL(raw); } catch (e) { pathValue.textContent = ''; pathTokens.innerHTML = ''; queryList.innerHTML = ''; hashPathValue.textContent = ''; hashPathTokens.innerHTML = ''; hashQueryList.innerHTML = ''; return; }
      const pathname = u.pathname || '';
      const pathSegs = pathname.split('/').filter(Boolean);
      pathValue.textContent = pathname;
      renderChips(pathTokens, pathSegs);
      const qParams = new URLSearchParams(u.search || '');
      renderKVList(queryList, qParams.entries());
      const hash = (u.hash || '').replace(/^#/, '');
      let hashPath = '', hashQuery = '';
      const qIdx = hash.indexOf('?');
      if (qIdx >= 0) { hashPath = hash.slice(0, qIdx); hashQuery = hash.slice(qIdx + 1); } else { hashPath = hash; }
      hashPathValue.textContent = hashPath;
      const hashSegs = hashPath.split('/').filter(Boolean);
      renderChips(hashPathTokens, hashSegs);
      const hParams = new URLSearchParams(hashQuery || '');
      renderKVList(hashQueryList, hParams.entries());
    }

    parseBtn.addEventListener('click', parseCurrent);
    urlInput.addEventListener('input', parseCurrent);
    function buildSampleFromFile() {
      const base = location.href.split('#')[0].split('?')[0];
      return base + '/api/v2/storage/bucket-001/files?view=list#/viewer/pdf/doc-99?mode=edit&zoom=100';
    }
    urlInput.value = buildSampleFromFile();
    parseCurrent();
    makeRealBtn.addEventListener('click', function() {
      const next = urlInput.value.trim() || buildSampleFromFile();
      try { new URL(next); } catch (e) { return; }
      history.replaceState(null, '', next);
      parseCurrent();
    });
  </script>
</body>
</html>
